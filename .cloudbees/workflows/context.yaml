apiVersion: automation.cloudbees.io/v1alpha1
kind: workflow
name: List Contexts

on:
  workflow_dispatch:
  push:
    branches:
      - "cb-context"

env:
  WORKFLOW_VAR: "This is a workflow environment variable"

jobs:
  contexts:
    steps:
    - name: event_name
      uses: docker://alpine:3.20
      run: echo "${{ cloudbees.event_name }}"
    - name: event
      uses: docker://alpine:3.20
      run: echo "${{ toJSON(cloudbees.event) }}"
    - name: home
      uses: docker://alpine:3.20
      run: echo ${{ cloudbees.home }}
    - name: run_id
      uses: docker://alpine:3.20
      run: echo ${{ cloudbees.run_id }}
    - name: run_attempt
      uses: docker://alpine:3.20
      run: echo ${{ cloudbees.run_attempt }}
    - name: version
      uses: docker://alpine:3.20
      run: echo ${{ cloudbees.version }}
    - name: api
      uses: docker://alpine:3.20
      run: |
        echo "${{ cloudbees.api.token }}"
        echo "${{ cloudbees.api.url }}"
    - name: scm
      id: scm
      uses: docker://alpine:3.20
      run: |
        echo "cloudbees.scm: ${{ toJSON(cloudbees.scm) }}"
        echo "provider: ${{ cloudbees.scm.provider }}"
        echo "provider_url: ${{ cloudbees.scm.provider_url }}"
        echo "repository: ${{ cloudbees.scm.repository }}"
        echo "sha: ${{ cloudbees.scm.sha }}"
        echo "branch: ${{ cloudbees.scm.branch }}"
        echo "ref: ${{ cloudbees.scm.ref }}"
        echo "repositoryUrl: ${{ cloudbees.scm.repositoryUrl }}"
  generate-greeting:
    outputs:
      greeting: ${{ steps.greet.outputs.greeting }}
    steps:
      - id: greet
        uses: docker://alpine:3.20
        run: |
          echo "hello world" > $CLOUDBEES_OUTPUTS/greeting
  print-greeting:
    needs:
      - generate-greeting
    steps:
      - name: print
        uses: docker://alpine:3.20
        run: |
          echo ${{ needs.generate-greeting.outputs.greeting }}
  build:
    env:
      JOB_VAR: "This is a job environment variable"
    steps:
      - name: checkout
        uses: docker://alpine:3.20
        run: |
          echo ${WORKFLOW_VAR}
          echo ${JOB_VAR}
          echo ${STEP_VAR}
        env:
          STEP_VAR: "This is a step environment variable"